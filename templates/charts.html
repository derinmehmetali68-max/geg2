{% extends "base.html" %}

{% block title %}Otomasyon Grafikleri{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
.chart-container {
    position: relative;
    height: 300px;
    margin-bottom: 20px;
}
.chart-container.large {
    height: 400px;
}
.chart-container.small {
    height: 200px;
}
.metric-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
    padding: 20px;
    color: white;
    text-align: center;
    margin-bottom: 20px;
}
.metric-card.success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
.metric-card.warning { background: linear-gradient(135deg, #fcb045 0%, #fd1d1d 100%); }
.metric-card.info { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.metric-card.danger { background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); }
.real-time-indicator {
    display: inline-block;
    width: 10px;
    height: 10px;
    background: #00ff00;
    border-radius: 50%;
    animation: pulse 2s infinite;
}
@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}
.filter-panel {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 30px;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">
                <i class="bi bi-graph-up-arrow"></i> Otomasyon Grafikleri & Analizler
                <span class="real-time-indicator ms-2"></span>
                <small class="text-muted">Gerçek Zamanlı</small>
            </h2>
            
            <!-- Filtre Paneli -->
            <div class="filter-panel">
                <div class="row align-items-end">
                    <div class="col-md-2">
                        <label class="form-label">Zaman Aralığı</label>
                        <select class="form-select" id="timeRange" onchange="updateAllCharts()">
                            <option value="1d">Son 24 Saat</option>
                            <option value="7d" selected>Son 7 Gün</option>
                            <option value="30d">Son 30 Gün</option>
                            <option value="90d">Son 3 Ay</option>
                            <option value="1y">Son 1 Yıl</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Grafik Türü</label>
                        <select class="form-select" id="chartType" onchange="switchChartTypes()">
                            <option value="all">Tümü</option>
                            <option value="performance">Performans</option>
                            <option value="user">Kullanıcı</option>
                            <option value="inventory">Envanter</option>
                            <option value="automation">Otomasyon</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Güncelleme</label>
                        <select class="form-select" id="refreshRate" onchange="setRefreshRate()">
                            <option value="0">Manuel</option>
                            <option value="30" selected>30 saniye</option>
                            <option value="60">1 dakika</option>
                            <option value="300">5 dakika</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary" onclick="refreshAllCharts()">
                            <i class="bi bi-arrow-clockwise"></i> Yenile
                        </button>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-success" onclick="exportAllCharts()">
                            <i class="bi bi-download"></i> Export
                        </button>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-info" onclick="toggleFullscreen()">
                            <i class="bi bi-fullscreen"></i> Tam Ekran
                        </button>
                    </div>
                </div>
            </div>

            <!-- Gerçek Zamanlı Metrikler -->
            <div class="row mb-4">
                <div class="col-md-2">
                    <div class="metric-card success">
                        <h3 id="activeUsers">24</h3>
                        <p>Aktif Kullanıcı</p>
                        <small>Son 5 dk</small>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="metric-card info">
                        <h3 id="systemLoad">67%</h3>
                        <p>Sistem Yükü</p>
                        <small>CPU + RAM</small>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="metric-card warning">
                        <h3 id="responseTime">142ms</h3>
                        <p>Yanıt Süresi</p>
                        <small>Ortalama</small>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="metric-card success">
                        <h3 id="automationTasks">89</h3>
                        <p>Otomasyon Görev</p>
                        <small>Tamamlanan</small>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="metric-card info">
                        <h3 id="dataProcessed">2.4GB</h3>
                        <p>İşlenen Veri</p>
                        <small>Bugün</small>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="metric-card danger">
                        <h3 id="errorRate">0.3%</h3>
                        <p>Hata Oranı</p>
                        <small>Son 1 saat</small>
                    </div>
                </div>
            </div>

            <!-- Ana Grafikler - 1. Satır -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card shadow-sm">
                        <div class="card-header d-flex justify-content-between">
                            <h5><i class="bi bi-speedometer2"></i> Sistem Performansı</h5>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary active" onclick="switchPerformanceView('cpu')">CPU</button>
                                <button class="btn btn-outline-primary" onclick="switchPerformanceView('memory')">RAM</button>
                                <button class="btn btn-outline-primary" onclick="switchPerformanceView('disk')">Disk</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="performanceChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5><i class="bi bi-activity"></i> Gerçek Zamanlı Aktivite</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="realtimeChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ana Grafikler - 2. Satır -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5><i class="bi bi-robot"></i> Otomasyon Görevleri</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="automationChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5><i class="bi bi-people"></i> Kullanıcı Dağılımı</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="userDistributionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5><i class="bi bi-database"></i> Veri İşleme</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="dataProcessingChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detaylı Analizler - 3. Satır -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <div class="card shadow-sm">
                        <div class="card-header d-flex justify-content-between">
                            <h5><i class="bi bi-graph-up"></i> Trend Analizi</h5>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-success active" onclick="switchTrendMetric('transactions')">İşlemler</button>
                                <button class="btn btn-outline-success" onclick="switchTrendMetric('users')">Kullanıcılar</button>
                                <button class="btn btn-outline-success" onclick="switchTrendMetric('automation')">Otomasyon</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container large">
                                <canvas id="trendAnalysisChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5><i class="bi bi-exclamation-triangle"></i> Sistem Uyarıları</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="alertsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Otomasyon Detayları - 4. Satır -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5><i class="bi bi-clock-history"></i> Yanıt Süreleri</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="responseTimeChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5><i class="bi bi-hdd-network"></i> Ağ Trafiği</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="networkChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5><i class="bi bi-shield-check"></i> Güvenlik</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="securityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5><i class="bi bi-lightning"></i> API Kullanımı</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="apiUsageChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Envanter & Kullanıcı Analizleri - 5. Satır -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5><i class="bi bi-boxes"></i> Envanter Durumu</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="inventoryChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5><i class="bi bi-person-check"></i> Kullanıcı Aktivite Haritası</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="userActivityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Karşılaştırmalı Analizler - 6. Satır -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5><i class="bi bi-bar-chart-steps"></i> Haftalık Karşılaştırma</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="weeklyComparisonChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5><i class="bi bi-calendar3"></i> Aylık Trend</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="monthlyTrendChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5><i class="bi bi-graph-down"></i> Hata Analizi</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="errorAnalysisChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gelişmiş Metrikler - 7. Satır -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card shadow-sm">
                        <div class="card-header d-flex justify-content-between">
                            <h5><i class="bi bi-speedometer"></i> Gelişmiş Performans Dashboard</h5>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-info active" onclick="switchDashboardView('overview')">Genel</button>
                                <button class="btn btn-outline-info" onclick="switchDashboardView('detailed')">Detaylı</button>
                                <button class="btn btn-outline-info" onclick="switchDashboardView('predictive')">Tahminsel</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container large">
                                <canvas id="advancedDashboardChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
// Global değişkenler
let charts = {};
let refreshInterval = null;
let isFullscreen = false;

// Sayfa yüklendiğinde
document.addEventListener('DOMContentLoaded', function() {
    initializeAllCharts();
    setRefreshRate();
});

// Tüm grafikleri başlat
function initializeAllCharts() {
    initPerformanceChart();
    initRealtimeChart();
    initAutomationChart();
    initUserDistributionChart();
    initDataProcessingChart();
    initTrendAnalysisChart();
    initAlertsChart();
    initResponseTimeChart();
    initNetworkChart();
    initSecurityChart();
    initApiUsageChart();
    initInventoryChart();
    initUserActivityChart();
    initWeeklyComparisonChart();
    initMonthlyTrendChart();
    initErrorAnalysisChart();
    initAdvancedDashboardChart();
}

// 1. Sistem Performansı Grafiği
function initPerformanceChart() {
    const ctx = document.getElementById('performanceChart').getContext('2d');
    charts.performance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: generateTimeLabels(24),
            datasets: [{
                label: 'CPU (%)',
                data: generateRandomData(24, 20, 80),
                borderColor: '#ff6384',
                backgroundColor: 'rgba(255, 99, 132, 0.1)',
                tension: 0.4
            }, {
                label: 'RAM (%)',
                data: generateRandomData(24, 30, 70),
                borderColor: '#36a2eb',
                backgroundColor: 'rgba(54, 162, 235, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100
                }
            }
        }
    });
}

// 2. Gerçek Zamanlı Aktivite
function initRealtimeChart() {
    const ctx = document.getElementById('realtimeChart').getContext('2d');
    charts.realtime = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Aktif İşlemler',
                data: [],
                borderColor: '#4bc0c0',
                backgroundColor: 'rgba(75, 192, 192, 0.1)',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                duration: 0
            },
            scales: {
                x: {
                    type: 'time',
                    time: {
                        unit: 'minute'
                    }
                },
                y: {
                    beginAtZero: true
                }
            }
        }
    });
    
    // Gerçek zamanlı veri simülasyonu
    setInterval(() => {
        const now = new Date();
        const value = Math.floor(Math.random() * 50) + 10;
        
        charts.realtime.data.labels.push(now);
        charts.realtime.data.datasets[0].data.push(value);
        
        if (charts.realtime.data.labels.length > 20) {
            charts.realtime.data.labels.shift();
            charts.realtime.data.datasets[0].data.shift();
        }
        
        charts.realtime.update('none');
    }, 2000);
}

// 3. Otomasyon Görevleri
function initAutomationChart() {
    const ctx = document.getElementById('automationChart').getContext('2d');
    charts.automation = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Tamamlanan', 'Bekleyen', 'Başarısız', 'İptal'],
            datasets: [{
                data: [89, 12, 3, 2],
                backgroundColor: ['#4bc0c0', '#ffce56', '#ff6384', '#c9cbcf']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
}

// 4. Kullanıcı Dağılımı
function initUserDistributionChart() {
    const ctx = document.getElementById('userDistributionChart').getContext('2d');
    charts.userDistribution = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Aktif', 'Pasif', 'Yeni', 'Ziyaretçi'],
            datasets: [{
                data: [45, 25, 15, 15],
                backgroundColor: ['#36a2eb', '#ff9f40', '#4bc0c0', '#9966ff']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
}

// 5. Veri İşleme
function initDataProcessingChart() {
    const ctx = document.getElementById('dataProcessingChart').getContext('2d');
    charts.dataProcessing = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Giriş', 'İşleme', 'Çıkış', 'Hata'],
            datasets: [{
                label: 'GB',
                data: [2.4, 2.1, 2.0, 0.1],
                backgroundColor: ['#4bc0c0', '#36a2eb', '#4bc0c0', '#ff6384']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

// 6. Trend Analizi
function initTrendAnalysisChart() {
    const ctx = document.getElementById('trendAnalysisChart').getContext('2d');
    charts.trendAnalysis = new Chart(ctx, {
        type: 'line',
        data: {
            labels: generateDateLabels(30),
            datasets: [{
                label: 'İşlemler',
                data: generateTrendData(30),
                borderColor: '#ff6384',
                backgroundColor: 'rgba(255, 99, 132, 0.1)',
                tension: 0.4
            }, {
                label: 'Ortalama',
                data: generateAverageData(30),
                borderColor: '#36a2eb',
                backgroundColor: 'rgba(54, 162, 235, 0.1)',
                tension: 0.4,
                borderDash: [5, 5]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                intersect: false,
                mode: 'index'
            }
        }
    });
}

// 7. Sistem Uyarıları
function initAlertsChart() {
    const ctx = document.getElementById('alertsChart').getContext('2d');
    charts.alerts = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Kritik', 'Uyarı', 'Bilgi', 'Çözüldü'],
            datasets: [{
                data: [2, 8, 15, 45],
                backgroundColor: ['#ff6384', '#ffce56', '#36a2eb', '#4bc0c0']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
}

// 8. Yanıt Süreleri
function initResponseTimeChart() {
    const ctx = document.getElementById('responseTimeChart').getContext('2d');
    charts.responseTime = new Chart(ctx, {
        type: 'line',
        data: {
            labels: generateTimeLabels(12),
            datasets: [{
                label: 'ms',
                data: generateRandomData(12, 50, 200),
                borderColor: '#ff9f40',
                backgroundColor: 'rgba(255, 159, 64, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

// 9. Ağ Trafiği
function initNetworkChart() {
    const ctx = document.getElementById('networkChart').getContext('2d');
    charts.network = new Chart(ctx, {
        type: 'line',
        data: {
            labels: generateTimeLabels(24),
            datasets: [{
                label: 'Gelen (MB/s)',
                data: generateRandomData(24, 10, 50),
                borderColor: '#4bc0c0',
                backgroundColor: 'rgba(75, 192, 192, 0.1)'
            }, {
                label: 'Giden (MB/s)',
                data: generateRandomData(24, 5, 30),
                borderColor: '#ff6384',
                backgroundColor: 'rgba(255, 99, 132, 0.1)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

// 10. Güvenlik
function initSecurityChart() {
    const ctx = document.getElementById('securityChart').getContext('2d');
    charts.security = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Güvenli', 'Şüpheli', 'Engellendi'],
            datasets: [{
                data: [95, 3, 2],
                backgroundColor: ['#4bc0c0', '#ffce56', '#ff6384']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
}

// 11. API Kullanımı
function initApiUsageChart() {
    const ctx = document.getElementById('apiUsageChart').getContext('2d');
    charts.apiUsage = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Books', 'Members', 'Trans', 'Reports'],
            datasets: [{
                label: 'İstek/saat',
                data: [450, 320, 180, 95],
                backgroundColor: '#36a2eb'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

// 12. Envanter Durumu
function initInventoryChart() {
    const ctx = document.getElementById('inventoryChart').getContext('2d');
    charts.inventory = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Mevcut', 'Ödünç', 'Bakımda', 'Kayıp'],
            datasets: [{
                label: 'Kitap Sayısı',
                data: [1250, 340, 25, 8],
                backgroundColor: ['#4bc0c0', '#36a2eb', '#ffce56', '#ff6384']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

// 13. Kullanıcı Aktivite Haritası
function initUserActivityChart() {
    const ctx = document.getElementById('userActivityChart').getContext('2d');
    charts.userActivity = new Chart(ctx, {
        type: 'scatter',
        data: {
            datasets: [{
                label: 'Aktivite',
                data: generateScatterData(50),
                backgroundColor: 'rgba(54, 162, 235, 0.6)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    type: 'linear',
                    position: 'bottom',
                    title: {
                        display: true,
                        text: 'Saat'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Kullanıcı ID'
                    }
                }
            }
        }
    });
}

// 14. Haftalık Karşılaştırma
function initWeeklyComparisonChart() {
    const ctx = document.getElementById('weeklyComparisonChart').getContext('2d');
    charts.weeklyComparison = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['Pazartesi', 'Salı', 'Çarşamba', 'Perşembe', 'Cuma', 'Cumartesi', 'Pazar'],
            datasets: [{
                label: 'Bu Hafta',
                data: [85, 92, 88, 95, 90, 75, 60],
                borderColor: '#4bc0c0',
                backgroundColor: 'rgba(75, 192, 192, 0.2)'
            }, {
                label: 'Geçen Hafta',
                data: [80, 85, 82, 88, 85, 70, 55],
                borderColor: '#ff6384',
                backgroundColor: 'rgba(255, 99, 132, 0.2)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
}

// 15. Aylık Trend
function initMonthlyTrendChart() {
    const ctx = document.getElementById('monthlyTrendChart').getContext('2d');
    charts.monthlyTrend = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Oca', 'Şub', 'Mar', 'Nis', 'May', 'Haz'],
            datasets: [{
                label: 'Trend',
                data: [120, 135, 145, 158, 142, 165],
                borderColor: '#9966ff',
                backgroundColor: 'rgba(153, 102, 255, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
}

// 16. Hata Analizi
function initErrorAnalysisChart() {
    const ctx = document.getElementById('errorAnalysisChart').getContext('2d');
    charts.errorAnalysis = new Chart(ctx, {
        type: 'line',
        data: {
            labels: generateTimeLabels(24),
            datasets: [{
                label: 'Hata Sayısı',
                data: generateRandomData(24, 0, 5),
                borderColor: '#ff6384',
                backgroundColor: 'rgba(255, 99, 132, 0.1)',
                tension: 0.4,
                stepped: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

// 17. Gelişmiş Dashboard
function initAdvancedDashboardChart() {
    const ctx = document.getElementById('advancedDashboardChart').getContext('2d');
    charts.advancedDashboard = new Chart(ctx, {
        type: 'line',
        data: {
            labels: generateDateLabels(7),
            datasets: [{
                label: 'Performans Skoru',
                data: [85, 88, 92, 89, 94, 91, 96],
                borderColor: '#4bc0c0',
                backgroundColor: 'rgba(75, 192, 192, 0.1)',
                tension: 0.4,
                yAxisID: 'y'
            }, {
                label: 'Kullanıcı Memnuniyeti',
                data: [4.2, 4.3, 4.5, 4.4, 4.6, 4.5, 4.7],
                borderColor: '#ff9f40',
                backgroundColor: 'rgba(255, 159, 64, 0.1)',
                tension: 0.4,
                yAxisID: 'y1'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                intersect: false,
                mode: 'index'
            },
            scales: {
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    max: 100
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    max: 5,
                    grid: {
                        drawOnChartArea: false,
                    },
                }
            }
        }
    });
}

// Yardımcı fonksiyonlar
function generateTimeLabels(hours) {
    const labels = [];
    for (let i = hours; i >= 0; i--) {
        const time = new Date();
        time.setHours(time.getHours() - i);
        labels.push(time.getHours() + ':00');
    }
    return labels;
}

function generateDateLabels(days) {
    const labels = [];
    for (let i = days; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        labels.push(date.toLocaleDateString('tr-TR', { month: 'short', day: 'numeric' }));
    }
    return labels;
}

function generateRandomData(count, min, max) {
    return Array.from({length: count}, () => Math.floor(Math.random() * (max - min + 1)) + min);
}

function generateTrendData(count) {
    const data = [];
    let base = 50;
    for (let i = 0; i < count; i++) {
        base += (Math.random() - 0.5) * 10;
        data.push(Math.max(0, Math.round(base)));
    }
    return data;
}

function generateAverageData(count) {
    return Array.from({length: count}, () => 50 + Math.sin(Math.PI * 2 * Math.random()) * 10);
}

function generateScatterData(count) {
    return Array.from({length: count}, () => ({
        x: Math.random() * 24,
        y: Math.floor(Math.random() * 100) + 1
    }));
}

// Kontrol fonksiyonları
function updateAllCharts() {
    // Tüm grafikleri güncelle
    Object.keys(charts).forEach(key => {
        if (charts[key] && typeof charts[key].update === 'function') {
            charts[key].update();
        }
    });
    updateMetrics();
}

function updateMetrics() {
    // Gerçek zamanlı metrikleri güncelle
    document.getElementById('activeUsers').textContent = Math.floor(Math.random() * 50) + 10;
    document.getElementById('systemLoad').textContent = Math.floor(Math.random() * 40) + 40 + '%';
    document.getElementById('responseTime').textContent = Math.floor(Math.random() * 100) + 100 + 'ms';
    document.getElementById('automationTasks').textContent = Math.floor(Math.random() * 20) + 80;
    document.getElementById('dataProcessed').textContent = (Math.random() * 2 + 1).toFixed(1) + 'GB';
    document.getElementById('errorRate').textContent = (Math.random() * 0.5).toFixed(1) + '%';
}

function setRefreshRate() {
    const rate = document.getElementById('refreshRate').value;
    if (refreshInterval) {
        clearInterval(refreshInterval);
    }
    if (rate > 0) {
        refreshInterval = setInterval(updateAllCharts, rate * 1000);
    }
}

function refreshAllCharts() {
    updateAllCharts();
}

function exportAllCharts() {
    // Tüm grafikleri PNG olarak export et
    const zip = new JSZip();
    Object.keys(charts).forEach(key => {
        const canvas = charts[key].canvas;
        const imgData = canvas.toDataURL('image/png');
        zip.file(`${key}_chart.png`, imgData.split(',')[1], {base64: true});
    });
    
    zip.generateAsync({type: "blob"}).then(function(content) {
        const link = document.createElement('a');
        link.download = `otomasyon_grafikleri_${new Date().toISOString().split('T')[0]}.zip`;
        link.href = URL.createObjectURL(content);
        link.click();
    });
}

function toggleFullscreen() {
    if (!isFullscreen) {
        document.documentElement.requestFullscreen();
        isFullscreen = true;
    } else {
        document.exitFullscreen();
        isFullscreen = false;
    }
}

// Görünüm değiştirme fonksiyonları
function switchPerformanceView(metric) {
    // Performans grafiği görünümünü değiştir
    document.querySelectorAll('.btn-group .btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
}

function switchTrendMetric(metric) {
    // Trend analizi metriğini değiştir
    document.querySelectorAll('.btn-group .btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
}

function switchDashboardView(view) {
    // Dashboard görünümünü değiştir
    document.querySelectorAll('.btn-group .btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
}

function switchChartTypes() {
    const type = document.getElementById('chartType').value;
    // Grafik türüne göre filtreleme yap
    console.log('Grafik türü değiştirildi:', type);
}

// İlk yükleme
setTimeout(updateMetrics, 1000);
</script>
{% endblock %}

